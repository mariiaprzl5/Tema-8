---
title: |
 ![](Logo_UCO.png){width=15%}
 "informe nils 2.00"
 ![](Logo_FacCiencias.png){width=15%}
author: "AInhoa Romero PÃ©rez b22ropea@uco.es"
date: "`r Sys.Date()`"
output: 
 html_document:
   toc: TRUE
   number_sections: TRUE
   bibliography: [NILs.bib, libraries.bib]
link-citation: TRUE
---

```{=html}
<!--ANTES DE COMENZAR ESCRIBIMOS LOS PAQUETES QUE VAMOS A UTILIZAR

<!-- knitr::write_bib(c(.packages(), 'dplyr', 'ggplot2', 'knitr', 'tinytex'), 'libraries.bib') -->
```

<!-- El siguiente codigo sirve para ocultar la informacion y por norma general se muestren los codigos-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!--Cargar las libreias que vamos a utilizar, queremos que el codigo se ejecute, pero no aparezca en el documento final, tambien excluimos los avisos y mensajes-->

```{r cargar-librerias, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
```

<!--Para generar ttulos, subtitulos etc se usa # el nmero de # determina el estilo y el formato del texto-->

# Introduccion

## El trabajo seleccionado

Vamos a trabajar con los datos de [@perez2024phenotypic]. Este trabajo describe [genes candidatos]{style="color: green;"} de la floracion en [garbanzo]{style="color: red;"} (*Cicer arietinum*) como **MED16**, **BBX24** o **ELF3**, este ultimo tambien reportado por otros estudios como [@ridge_chickpea_2017]. Los mecanismos bsicos de floracin estudiados en la planta modelo *Arabidopsis thaliana* estn conservados en las leguminosas ([@weller_genetic_2019; @hecht_conservation_2005; @weller_genetic_2015]), exceptuando ciertos genes como **CONSTANS** [@wong_isolation_2014].

## Los datos

<!-- Importamos los datospara poder mostrar una primera vista-->

```<!-- Leer los datos desde el fichero que esta en el amisma carpeta que Rmarkdown. Sie el fichero est en otra carpeta actualizar la localizacin del archivo-->

```{r leer-datos, echo=FALSE, warning=FALSE}
library(readxl)
Data <- read_excel("12870_2024_5411_MOESM1_ESM.xlsx",
   skip = 1)
```

<!-- Links a pginas/archivos externos [](direccinLink)-->

Los datos de este proyecto fueron descaragdos desde [NILs Adrian] (<https://bmcplantbiol.biomedcentral.com/articles/10.1186/s12870-024-05411-y>)

<!-- Primera vsita de los datos -->

```{r vista-datos, echo=FALSE}
knitr::kable(head(Data, 8), align = 'c', caption = "Tabla 1: Ocho primeras filas")

```

<!-- El codigo en R en linea-->

Los datos tiene `r nrow(Data)` filas y `r ncol(Data)`columnas. 

Cada fila se corresponde con un SNP, por tanto, hay `r nrow(Data)` SNPs.


<!-- Filtra los datos para quedarte solo con los cromosomas (sus cdigos empiezan por NC_)-->

```{r Filtro-cromosoma, include = FALSE}
Data <- Data %>% filter(CHROM %in% c("NC_021160.1","NC_021161.1","NC_021162.1","NC_021163.1","NC_021164.1","NC_021166.1","NC_021167.1"))

```

Del total de SNPs detectados, `r nrow(Data)`se corresponden con SNPs situados en cromosomas (Figura 1)

<!-- Calcula el nmero de SNPs por cromosoma que tiene el garabanzo con la funcin `count` y guarda los datos ordenados de forma descendiente en variable nueva-->

```{r cromosoma-con-mas-SNPs, echo = FALSE}
Cromosomas <- Data %>% 
 count(CHROM) %>% 
 arrange(desc(n))
  
```

<!-- Utilizar la variable nueva para hacer un grfico de barras incluyendo el pie de figura y la posicion -->

```{r grafico-cromosoma-SNPs, echo=FALSE, out.width="60%", fig.cap="Figura 1. Numero de SNPs por cromosomas", fig.align='center'}
ggplot(Cromosomas) +
  geom_col(aes(y = n, x = CHROM))+
  xlab("Cromosomas")+
  ylab("Num.SNPs")

```

## Hipotesis

Nuestra hipotesis es que los cromosomas con mayor numero de SNPs presentan mayor % de SNPs que no pasan el filtro de calidad

# Materiales y metodos

<!-- Para indicar una referencia se utiliza [@codigo] -->

Para llevar a cabo el analisis usamos R [@R-base] con las librerias dplyr [@R-dplyr] y ggplot [@R-ggplot2; @ggplot22016]. Para la creacion de este informe hemos utilizado el paquete knitr [@R-knitr; @knitr2015; @knitr2014] y pandoc.

# Resultados

<!-- Selecciona del datset `Data unicamnete las columnas **CHROM**, **POS** y **FILTER**. -->

```{r seleccion_columnas, echo=FALSE}
datos_filtrados <- Data %>% 
  select(CHROM, POS, FILTER)
```

<!-- Crea una nueva variable en la que todo valor distinto de *PASS* se tranforme en *NOT_PASS*. -->

```{r recodificacion, echo=FALSE}
datos_filtrados <- datos_filtrados %>% 
  mutate(FILTER = ifelse(FILTER == "PASS", "PASS", "NOT_PASS"))
```

## Calculo de porcentajes por cromosomas

```{r,echo=FALSE}
# Calcular el numero total de SNPs y el porcentaje de NOT_PASS por cromosoma
resumen_relacion <- datos_filtrados %>% 
  group_by(CHROM) %>%
  summarise(
    total_SNPs = n(),
    not_pass = sum(FILTER == "NOT_PASS"),
    porcentaje_not_pass = round(not_pass / total_SNPs * 100, 1)
  )
```

El porcentaje de SNPs que no pasan el filtro se muestran en la Tabla 2.

```{r, echo=FALSE}
knitr::kable(
  resumen_relacion %>% 
    mutate(porcentaje_not_pass = paste0(porcentaje_not_pass,
"%")),
caption = "Tabla 2. Porcentaje de SNPs que pasan y no pasan el filtro por cromosoma"
)

```

## Representacion grafica

El siguiente modelo muestra la relacion entre el numero toral y los SNPs no filtrados (Figura 2)

```{r grafico-relacion, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Fig 2. Relacion entre el numero total de SNPs y el porcentaje de SNPs que no pasan el filtro de calidad"}
ggplot(resumen_relacion, aes(x = total_SNPs, y = porcentaje_not_pass)) +
  geom_point(color = "darkblue", size = 3) +
  geom_smooth(method = "lm", se = FALSE, color ="red") +
  labs(x = "numero total de SNPs por cromosoma",
       y = "% de SNPs que no pasan el filtro")

```



# Conclusiones

Los datos No apoyan nuestra hipotesis. Es la contraria: los cromosomas en los que se detectan menos SNPs, presentan mayor porcentaje de SNPs que no pasan el filtro

<!-- Para asegurarla reproducibilidad de los resultados es necesario concocer el ssitema operativo y la version de software y paquetes-->

# Informacion de la sesion y referencias

```{r sessionInfo, echo=FALSE}
session <- sessionInfo()
print(session)
```



